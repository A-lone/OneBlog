@model OneBlog.Models.CommentViewModels.CommentViewModel
@inject UserManager<ApplicationUser> UserManager
@{
    var CurrentUser = await UserManager.GetUserAsync(User);
}
<div class="row">
    <div>
        <div id="comment" class="well-global animated fadeInUp" style="animation-duration: 0.6s; animation-timing-function: ease-in-out;">

            <div id="comment-form" class="panel panel-primary comment-form-containter">
                <div class="panel-heading">
                    <span id="comment-title">评论 </span>
                    @if (CurrentUser == null)
                    {
                        <span><a asp-action="Login" asp-controller="Account" asp-route-ReturnUrl="@Context.Request.Path">(登录)</a></span>
                    }
                    <a id="cancelReply" style="display: none;" class="pull-right" href="javascript:void(0);" onclick="OneBlog.cancelReply();">取消回复</a>
                </div>
                <div class="panel-body">
                    <div>
                        <form id="commentForm" role="form">

                            @if (CurrentUser != null)
                            {
                                <div class="form-group">
                                    <div class="row">
                                        <div class="col-md-4">
                                            @Html.TextBoxFor(m => m.UserName, new { @class = "form-control", placeholder = "用户名", disabled = "disabled" })
                                        </div>
                                        <div class="col-md-8">
                                            @Html.TextBoxFor(m => m.Email, new { @class = "form-control", placeholder = "邮箱", disabled = "disabled" })
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    @Html.TextAreaFor(m => m.Content, new { @class = "form-control", placeholder = "内容", cols = "60", style = "height:100px;" })
                                </div>
                                <div class="form-group input-group">
                                    <span class="input-group-addon" style="padding:0;">
                                        <img id="captchaImg" style="max-width:none;" onclick="this.src ='@Url.Action("Captcha", "Root")?t='+ Math.floor(Math.random() * 10000);" src="@Url.Action("Captcha", "Root")" />
                                    </span>
                                    @Html.TextBoxFor(m => m.Captcha, new { @class = "form-control", placeholder = "验证码", cols = "60" })
                                </div>
                                <div class="form-group">
                                    <span class=" pull-right">
                                        <button id="btnSaveAjax" onclick="OneBlog.addComment();return false;" type="submit" class="btn btn-success ladda-button" data-style="expand-left">提交</button>
                                    </span>
                                </div>

                            }
                            else
                            {
                                <div class="form-group">
                                    <div class="row">
                                        <div class="col-md-4">
                                            @Html.TextBoxFor(m => m.UserName, new { @class = "form-control", placeholder = "用户名" })
                                        </div>
                                        <div class="col-md-8">
                                            @Html.TextBoxFor(m => m.Email, new { @class = "form-control", placeholder = "邮箱" })
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    @Html.TextAreaFor(m => m.Content, new { @class = "form-control", placeholder = "内容", cols = "60", style = "height:100px;" })
                                </div>
                                <div class="form-group input-group">
                                    <span class="input-group-addon" style="padding:0;">
                                        <img id="captchaImg" style="max-width:none;" onclick="this.src ='@Url.Action("Captcha", "Root")?t='+ Math.floor(Math.random() * 10000);" src="@Url.Action("Captcha", "Root")" />
                                    </span>
                                    @Html.TextBoxFor(m => m.Captcha, new { @class = "form-control", placeholder = "验证码", cols = "60" })
                                </div>
                                <div class="form-group">
                                    <span class=" pull-right">
                                        <button id="btnSaveAjax" onclick="OneBlog.addComment();return false;" type="submit" class="btn btn-success ladda-button" data-style="expand-left">提交</button>
                                    </span>
                                </div>
                            }
                            <input type="hidden" name="hiddenReplyTo" id="hiddenReplyTo" />
                            @Html.HiddenFor(m => m.PostId)
                        </form>
                    </div>
                </div>
            </div>

            <div id="commentlist" style="display: block">
                @foreach (var item in Model.Comments)
                {
                    @Html.Partial("_Comment", item)
                }
            </div>
        </div>
    </div>
</div>
